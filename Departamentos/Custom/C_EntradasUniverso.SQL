Select
	TO_DATE(t1."CreateDate") as "Data de Criação",
	CAST(t0."Data Lançamento" AS DATE) AS "Data Lançamento" ,
	t0."Data Documento", 
	TO_NVARCHAR(TO_DATE(t0."Data Documento"),'YYYY.MM') as "Mês",
	t0."BPLId",
	t0."Filial",
	t0."Número SAP",
	t0."DocEntry",
	t0."Número Referência PN",
	t0."Número Pedido Cliente",
	t0."Tipo DOC",
	t0."Status Docto",
	Case 
		When LENGTH(t4."TaxId0") > 3 Then 'Pessoa Jurídica' 
		When LENGTH(t4."TaxId4") > 3 Then 'Pessoa Física'
	Else
		'Não Identificado'
	End as "Classificação PN",
	t0."Código PN",
	t0."Nome Abreviado",
	t0."Nome PN",
	t0."Grupo PN",
	t0."Nome Grupo PN",
	t0."Código Município",
	t0."Nome Município",
	t0."UF",
	t0."Região",
	t0."Código Vendedor",
	t0."Nome Vendedor",	
	t3."U_Loja" as "Classificação do Vendedor",
	t0."Serial" as "Número da Nota",
	t0."SeqName" as "Sequencia",
	t0."Model" as "Modelo",
	t0."Transportadora",
	t5."CardName" as "Nome Transportadora",
	t0."Código Utilização",
	t0."Nome Utilização",
	t0."Código Imposto",
	t0."CFOP",
	t0."Gratuito",
	t0."Terceiros",
	t0."Código Item",
	t6."SWW" as "SKU PreCode",
	t0."Descrição Item",
	t0."Descrição Item Doc",
	t0."Grupo",
	t0."Nome Grupo",
	t6."U_OKS_IPW_DSHierarquia" as "Hierarquia",
	t0."Depósito",
	t0."Quantidade",
	t0."CMV",
	t2."Price" as "Custo Manual",
	t2."Price" * t0."Quantidade" as "Custo Manual Total",
	t0."Unitário R$",
	t0."Total Mercadoria R$",
	t0."DA Frete",
	t0."DA Seguro",
	t0."DA Outros",
	t0."IMPOSTOS-I",
	t0."IMPOSTOS-NI",
	t0."Faturamento Bruto",
	t0."Faturamento Líquido",
	Case when (ifnull(t2."Price",0.00) = 0.00 or t0."Faturamento Bruto" = 0.00 or t0."Quantidade" = 0.00) then 0 else (t0."Faturamento Bruto"-(t2."Price"*t0."Quantidade"))/t0."Faturamento Bruto" end as "Margem Bruta",
	Case when (ifnull(t2."Price",0.00) = 0.00 or t0."Faturamento Bruto" = 0.00 or t0."Quantidade" = 0.00) then 0 else (t0."Faturamento Líquido"-(t2."Price"*t0."Quantidade"))/t0."Faturamento Líquido" end as "Margem Líquida",
	t0."COFINS-I",
	t0."PIS-I",
	t0."ICMS-I",
	t0."ICMSDest-I",
	t0."ICMSRemet-I",
	t0."FCP-I",
	t0."FCP-ST-I",
	t0."ICMS-ST-I",
	t0."IPI-I",
	t0."ISS-I",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	t0."OUTROS IMP-I",
	t0."COFINS-NI",
	t0."PIS-NI",
	t0."ICMS-NI",
	t0."ICMSDest-NI",
	t0."ICMSRemet-NI",
	t0."FCP-NI",
	t0."FCP-ST-NI",
	t0."ICMS-ST-NI",
	t0."IPI-NI",
	t0."ISS-NI",
	t0."CSLL-NI",
	t0."IRPJ-NI",
	t0."II-NI",
	t0."OUTROS IMP-NI"
From SBO_INPOWER_PROD."OKS_NFE" as t0
Inner Join SBO_INPOWER_PROD."OPCH" as t1 on t0."DocEntry" = t1."DocEntry"
Left Join SBO_INPOWER_PROD."ITM1" t2 ON t0."Código Item" = t2."ItemCode" and t2."PriceList" = '5'
Left Join SBO_INPOWER_PROD."OSLP" as t3 on t0."Código Vendedor" = t3."SlpCode"
Inner Join SBO_INPOWER_PROD."PCH12" as t4 on t0."DocEntry" = t4."DocEntry"
Left Join SBO_INPOWER_PROD."OCRD" as t5 on t0."Transportadora" = t5."CardCode"
Left Join SBO_INPOWER_PROD."OITM" t6 ON t0."Código Item" = t6."ItemCode"
where
      t0."Nome Utilização" NOT IN ('RETORNO CONSERTO', 'REMESSA CONSERTO', 'REM.P/DEP.TEMPORARIO', 'REMESSA VEND À ORDEM', 'RETORNO DE COMODATO', 'REM ENTREGA FUTURA')
	AND T0."Data Lançamento" BETWEEN '20240101' AND CURRENT_DATE